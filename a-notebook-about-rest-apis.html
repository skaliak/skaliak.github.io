<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>    A Notebook about REST APIs
</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
            <link rel="stylesheet" href="/theme/css/normalize.css">
        <link href='//fonts.googleapis.com/css?family=Lato' rel='stylesheet' type='text/css'>
        <link href='//fonts.googleapis.com/css?family=Oswald' rel='stylesheet' type='text/css'>
        <!-- replaced static FA with cdn -->
        <link rel="stylesheet" type="text/css" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        <!-- <link rel="stylesheet" href="/theme/css/font-awesome.min.css"> -->
        <link rel="stylesheet" href="/theme/css/main.css">

    <link rel="stylesheet" href="/theme/css/blog.css">
    <link rel="stylesheet" href="/theme/css/github.css">
        <script src="/theme/js/vendor/modernizr-2.6.2.min.js"></script>
        <script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
    </head>
    <body>
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

        <div id="wrapper">
<header id="sidebar" class="side-shadow">
    <hgroup id="site-header">
        <a id="site-title" href=""><h1><i class="fa fa-cubes"></i> Peter Lindberg</h1></a>
        <p id="site-desc"> Transitioning from an IT Systems Engineering career to Software Devleopment.  Recent CS graduate. </p>
    </hgroup>
    <nav>
        <ul id="nav-links">
                <li><a href="/">Blog</a></li>
                <li><a href="/pages/about-me.html">About me</a></li>
                <li><a href="/pages/contact-me.html">Contact</a></li>
                <li><a href="/pdfs/Resume.pdf">Résumé</a></li>
                <li><a href="/pages/projects.html">Projects</a></li>
        </ul>
        <div id="nav-services" class="centered-nav">
                <a href="https://github.com/skaliak" target="github"><i class="fa fa-github svc-badge"></i></a>
                <a href="http://www.linkedin.com/pub/peter-lindberg/b/9b8/a89" target="linkedin"><i class="fa fa-linkedin svc-badge"></i></a>
        </div
    </nav>
<footer id="site-info">
    <p>
        Proudly powered by <a href="http://getpelican.com/" target="pelican">Pelican</a> and <a href="http://python.org/" target="python">Python</a>. Theme by me, forked from <a href="https://github.com/hdra/pelican-cait" target="github">cait by hndr</a>.
    </p>
    <p>
        Textures by <a href="http://subtlepatterns.com/" target="subtlepatterns">Subtle Pattern</a>. Font Awesome by <a href="http://fortawesome.github.io/Font-Awesome/" target="github">Dave Grandy</a>.
    </p>
</footer></header>
    <div id="post-container">
        <ol id="post-list">
            <li>
                <article class="post-entry">
                    <header class="entry-header">
                        <time class="post-time" datetime="2015-04-09T15:37:00-07:00" pubdate>
                            Thu 09 April 2015
                        </time>
                        <a href="/a-notebook-about-rest-apis.html" rel="bookmark"><h1>A Notebook about REST APIs</h1></a>
                    </header>

                    <section class="post-content">
                        <html><body><p>This is an iPython Notebook that I wrote for a class assignment:

</p><div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Processing-REST-API-data-with-Python">Processing REST API data with Python<a class="anchor-link" href="#Processing-REST-API-data-with-Python">¶</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="By-Peter-Lindberg-for-CS496,-winter-2015">By Peter Lindberg for CS496, winter 2015<a class="anchor-link" href="#By-Peter-Lindberg-for-CS496,-winter-2015">¶</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So let's say you found out that your favorite website/service/whatever has a REST api.  Hopefully, if it has decent documentation, you can learn about all the resources you can create, retrieve, update, or delete, and even see some examples of how to do it.</p>
<p>However, what might not be so obvious is <em>what to do with the data</em>.  Often, the data returned by these apis has a complicated structure, and you might not be sure of how to process it.</p>
<p>"But wait!" you say, "why Python?  Wouldn't I typically be accessing this kind of api client-side via JavaScript?"</p>
<p>Well, maybe... but what if you wanted to develop a fast mobile app that accessed a small subset of the data provided by a 3rd party api?  In that case, your server-side code should act as a <em>proxy</em> to the api, streamlining the essential data for easy processing by your front-end code, and removing superfluous data to reduce network traffic.  There could also be CORS issues preventing you from accessing the api via client-side js.</p>
<p>Or maybe there is no front-end -- you just want to analyze the data, e.g. for the purpose of making a report or infographic?  In both of these cases Python is the ideal tool for the job.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="How-about-some-examples?">How about some examples?<a class="anchor-link" href="#How-about-some-examples?">¶</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's start with the api from Clever, which is for school data (i.e. students, classes, teachers, etc).</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [2]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'https://api.clever.com/v1.1/districts/4fd43cc56d11340000000005/sections'</span><span class="p">,</span> 
                 <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">'Authorization'</span><span class="p">:</span><span class="s">'Bearer DEMO_TOKEN'</span><span class="p">})</span>
<span class="n">r</span><span class="o">.</span><span class="n">status_code</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[2]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
200
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The status was 200, so hopefully some data was returned, which should represent a list of class sections for a particular school district.  Rather than printing out the whole response, let's carefully examine it in a heirarchical fashion...</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [3]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>

<span class="n">j</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="n">backup_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>  <span class="c">#save this for later</span>
<span class="n">j</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[3]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
[u'paging', u'data', u'links']
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>paging</code> and <code>links</code> are probably metadata (we'll get into those later).  Looks like the actual data is going to be under <code>data</code>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [4]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="nb">type</span><span class="p">(</span><span class="n">j</span><span class="p">[</span><span class="s">'data'</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[4]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
list
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>data</code> is a list, so let's look at one of it's elements.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [5]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">j</span><span class="p">[</span><span class="s">'data'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[5]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
[u'data', u'uri']
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Wait -- <em>another</em> <code>data</code> key?  And what is this <code>uri</code> key?</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [6]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">j</span><span class="p">[</span><span class="s">'data'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'uri'</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[6]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
u'/v1.1/sections/530e5979049e75a9262d0af2'
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Apparently, <code>uri</code> is the uri that will retrieve this resource directly.  This may or may not be convienient depending on what we actually want to do with the data.  Let's look in <code>data</code> and hopefully we'll find an actual data object, rather than more metadata.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [7]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">j</span><span class="p">[</span><span class="s">'data'</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s">'data'</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[7]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
{u'course_name': u'Group Guidance',
 u'course_number': u'101',
 u'created': u'2014-02-26T21:15:37.927Z',
 u'district': u'4fd43cc56d11340000000005',
 u'grade': u'10',
 u'id': u'530e5979049e75a9262d0af2',
 u'last_modified': u'2014-12-29T15:49:36.680Z',
 u'name': u'Group Guidance - 101 - B. Greene (Section 1)',
 u'period': u'0',
 u'school': u'530e595026403103360ff9fd',
 u'sis_id': u'581',
 u'students': [u'530e5960049e75a9262cff4f',
  u'530e5960049e75a9262cff95',
  u'530e5961049e75a9262cffe0',
  u'530e5961049e75a9262d0027',
  u'530e5961049e75a9262d008d',
  u'530e5963049e75a9262d0180',
  u'530e5964049e75a9262d0300',
  u'530e5964049e75a9262d0302',
  u'530e5964049e75a9262d0304',
  u'530e5965049e75a9262d039e',
  u'530e5965049e75a9262d03b6',
  u'530e5965049e75a9262d03e8',
  u'530e5966049e75a9262d040c',
  u'530e5966049e75a9262d04cc',
  u'530e5967049e75a9262d05c0',
  u'530e5968049e75a9262d062f'],
 u'subject': u'homeroom/advisory',
 u'teacher': u'530e5955d50c310f36112c11',
 u'teachers': [u'530e5955d50c310f36112c11'],
 u'term': {u'end_date': u'2013-06-01T00:00:00.000Z',
  u'name': u'Y1',
  u'start_date': u'2012-08-01T00:00:00.000Z'}}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Finally we've got some actual data!  This object has information about a particular section of a class, with elements such as <code>name</code>, <code>grade</code>, <code>period</code>, etc.  All the associated objects are referenced by their unique id (or list of ids), rather than being included directly, with the exception of <code>term</code>, which is a nested object.  </p>
<p>To make it easy to process all the <code>section</code> objects, let's strip away all the metadata.  The most elegant way to do this is to use a list comprehension:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [8]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">sec_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s">'data'</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">j</span><span class="p">[</span><span class="s">'data'</span><span class="p">]]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">sec_list</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[8]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
100
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Get-all-the-stats!">Get all the stats!<a class="anchor-link" href="#Get-all-the-stats!">¶</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To calculate some statistics about these sections, the first step is to do some aggregation.  We can get a list of the section class sizes (number of students) with another list comprehension:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [9]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">student_counts</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s">'students'</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sec_list</span><span class="p">]</span>
<span class="k">print</span> <span class="n">student_counts</span>
<span class="k">print</span> <span class="nb">len</span><span class="p">(</span><span class="n">student_counts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
[16, 14, 21, 13, 17, 17, 26, 26, 26, 26, 26, 26, 26, 26, 26, 16, 16, 17, 17, 17, 17, 20, 20, 20, 20, 16, 16, 17, 17, 17, 17, 16, 16, 17, 16, 17, 17, 16, 16, 17, 17, 17, 17, 19, 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 16, 16, 17, 17, 17, 17, 25, 25, 25, 25, 24, 20, 20, 20, 20, 20, 19, 25, 25, 50, 19, 26, 26, 26, 26, 26, 26, 26, 26, 26, 25, 25, 25, 25, 14, 26, 26, 26, 26, 26, 26, 33, 50, 50, 33]
100

</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Hmm... That's odd, it looks like there are exactly 100 sections.  There could be exactly 100 sections in this district, but what's more likely is that we've got a subset of the whole list.  Lets go back to that <code>paging</code> object we saw before:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [10]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">j</span><span class="p">[</span><span class="s">'paging'</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[10]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
{u'count': 381, u'current': 1, u'total': 4}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ah-ha!  Our original request returned page 1 out of 4, with a max of 100 per page.  We also now know that the total number of sections is [].  So how do we get <em>all</em> the sections?  We could make another request with the <code>limit</code> parameter set to a value higher than the total number of results:
<a href="https://api.clever.com/v1.1/districts/4fd43cc56d11340000000005/sections?limit=400">https://api.clever.com/v1.1/districts/4fd43cc56d11340000000005/sections?limit=400</a></p>
<p>But this is actually a <em>very bad</em> idea.  The api was designed with a paging feature for good reasons.  It prevents the client, server, and network from being overloaded by too much data.</p>
<p>Instead, we can make use of another very convenient piece of metadata:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [11]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">j</span><span class="p">[</span><span class="s">'links'</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[11]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
[{u'rel': u'self',
  u'uri': u'/v1.1/districts/4fd43cc56d11340000000005/sections'},
 {u'rel': u'next',
  u'uri': u'/v1.1/districts/4fd43cc56d11340000000005/sections?starting_after=530e597a049e75a9262d0b55'}]
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In <code>links</code> is the uri for the next page of results!  That was very thoughtful of the api designers to include for us!  And actually, this satisfies one of the constraints/requirements of a RESTful api:  HATEOAS.</p>
<p>The presense of a <strong>next</strong> link makes the response like one of the classic data structures -- a <strong>linked list</strong>.</p>
<p>Unfortunately, the <code>links</code> object does not contain the uris directly.  Instead it is a list of "link objects", with each one having a <code>rel</code> property, describing what it is for, and a <code>uri</code> property with the actual uri.  If we want to be able to iterate through the pages the way we would through a linked list, we need to transform the links into a more convenient form.  Let's use a <em>dictionary comprehension</em>:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [12]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="p">{</span><span class="n">x</span><span class="p">[</span><span class="s">'rel'</span><span class="p">]</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">'uri'</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">j</span><span class="p">[</span><span class="s">'links'</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[12]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
{u'next': u'/v1.1/districts/4fd43cc56d11340000000005/sections?starting_after=530e597a049e75a9262d0b55',
 u'self': u'/v1.1/districts/4fd43cc56d11340000000005/sections'}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Time-to-iterate">Time to iterate<a class="anchor-link" href="#Time-to-iterate">¶</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we have everything we need to iterate throught all the pages and build up a complete list of student totals which we can run some stats on.  A nice aspect of the paging system for this api is that the last page has a <code>current</code> in links, but no <code>next</code>.  This means that we can loop until there is no next, just as we would with a linked list:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [13]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">base_url</span> <span class="o">=</span> <span class="s">'https://api.clever.com'</span>
<span class="n">uri</span> <span class="o">=</span> <span class="s">'/v1.1/districts/4fd43cc56d11340000000005/sections'</span>
<span class="n">student_totals</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="n">uri</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_url</span> <span class="o">+</span> <span class="n">uri</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">'Authorization'</span><span class="p">:</span><span class="s">'Bearer DEMO_TOKEN'</span><span class="p">})</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">section_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s">'data'</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">j</span><span class="p">[</span><span class="s">'data'</span><span class="p">]]</span>
    <span class="n">student_totals</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s">'students'</span><span class="p">])</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">section_list</span><span class="p">]</span>
    <span class="n">links</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">[</span><span class="s">'rel'</span><span class="p">]</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">'uri'</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">j</span><span class="p">[</span><span class="s">'links'</span><span class="p">]}</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="n">links</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'next'</span><span class="p">)</span>
    
<span class="nb">len</span><span class="p">(</span><span class="n">student_totals</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[13]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
381
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We're ready to calculate some statistics about class (section) size.  There are built-ins for <code>max</code> and <code>min</code>, but not for <em>median</em> and <em>average</em>, so a couple of lambdas are needed:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [14]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">avg</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">median</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It would probably be prudent to test those:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [15]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">23</span><span class="p">,</span> <span class="mi">542</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">651</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">999</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">512</span><span class="p">]</span>

<span class="k">print</span> <span class="s">"average: "</span><span class="p">,</span> <span class="n">avg</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"median: "</span><span class="p">,</span> <span class="n">median</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"max: "</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"min: "</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
average:  323.333333333
median:  123
max:  999
min:  3

</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And now we can run them on our student data:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [16]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="k">print</span> <span class="s">"average section size: "</span><span class="p">,</span> <span class="n">avg</span><span class="p">(</span><span class="n">student_totals</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"median section size: "</span><span class="p">,</span> <span class="n">median</span><span class="p">(</span><span class="n">student_totals</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"max section size: "</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">student_totals</span><span class="p">)</span>
<span class="k">print</span> <span class="s">"min section size: "</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">student_totals</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
average section size:  23.56167979
median section size:  21
max section size:  50
min section size:  7

</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Getting-more-detail-about-max-and-min">Getting more detail about max and min<a class="anchor-link" href="#Getting-more-detail-about-max-and-min">¶</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Unlike average, which is an aggregate function, max and min represent specific classes, so it might be useful to get more information about <em>which</em> classes are the biggest and smallest.  To do that, we need to collect some more info from the api, so we'll modify our call slightly:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [28]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="kn">import</span> <span class="nn">requests</span>

<span class="n">base_url</span> <span class="o">=</span> <span class="s">'https://api.clever.com'</span>
<span class="n">uri</span> <span class="o">=</span> <span class="s">'/v1.1/districts/4fd43cc56d11340000000005/sections'</span>
<span class="n">section_list</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">while</span> <span class="n">uri</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_url</span> <span class="o">+</span> <span class="n">uri</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">'Authorization'</span><span class="p">:</span><span class="s">'Bearer DEMO_TOKEN'</span><span class="p">})</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">section_list</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="s">'data'</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">j</span><span class="p">[</span><span class="s">'data'</span><span class="p">]]</span>
    <span class="n">links</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">[</span><span class="s">'rel'</span><span class="p">]</span> <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s">'uri'</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">j</span><span class="p">[</span><span class="s">'links'</span><span class="p">]}</span>
    <span class="n">uri</span> <span class="o">=</span> <span class="n">links</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'next'</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this situation, it's easier to get the desired results with <code>filter</code> than with a list comprehension.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [29]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">cl</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">[</span><span class="s">'name'</span><span class="p">],</span>  <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s">'students'</span><span class="p">]))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">section_list</span><span class="p">]</span>
<span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="n">y</span> <span class="o">==</span> <span class="nb">max</span><span class="p">([</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">cl</span><span class="p">]),</span> <span class="n">cl</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[29]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
[(u'AP English Literature and Composition - 009 - B. Daniel', 50),
 (u'French III - 301 - G. Gorczany (Section 1)', 50),
 (u'French IV - 401 - G. Gorczany (Section 1)', 50),
 (u'Physical Education, Group 10A - 201 - P. McCartney', 50),
 (u'Physical Education, Group 11A - 301 - P. McCartney', 50),
 (u'Physical Education, Group 11B - 302 - P. McCartney', 50),
 (u'Physical Education, Group 12A - 401 - P. McCartney', 50),
 (u'Physical Education, Group 12B - 402 - P. McCartney', 50),
 (u'Physical Education, Group 9A - 101 - P. McCartney', 50),
 (u'Physical Education, Group 9B - 102 - P. McCartney', 50),
 (u'Spanish III - 301 - R. Gadsby (Section 1)', 50),
 (u'AP Spanish Language - 404 - R. Gadsby (Section 1)', 50)]
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [30]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="n">y</span> <span class="o">==</span> <span class="nb">min</span><span class="p">([</span><span class="n">y</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">cl</span><span class="p">]),</span> <span class="n">cl</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[30]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
[(u'Introduction to Electronics - 101 - Drake Buchla Glum', 7),
 (u'Advanced Electronics - 201 - Buchla Glum Drake', 7)]
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="A-more-general-approach">A more general approach<a class="anchor-link" href="#A-more-general-approach">¶</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our next example will be from the Reddit api.  The following request gets a list (limited to 2) of posts on /r/gandalf:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [19]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.reddit.com/r/gandalf.json?limit=2'</span><span class="p">,</span>
                 <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">'User-Agent'</span><span class="p">:</span> <span class="s">'OSU cs496 api howto ipynb'</span><span class="p">})</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
<span class="n">j</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[19]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
{u'data': {u'after': u't3_2vpjh7',
  u'before': None,
  u'children': [{u'data': {u'approved_by': None,
     u'archived': False,
     u'author': u'JakeNightly',
     u'author_flair_css_class': None,
     u'author_flair_text': None,
     u'banned_by': None,
     u'clicked': False,
     u'created': 1423888980.0,
     u'created_utc': 1423860180.0,
     u'distinguished': None,
     u'domain': u'40.media.tumblr.com',
     u'downs': 0,
     u'edited': False,
     u'gilded': 0,
     u'hidden': False,
     u'id': u'2vsxmq',
     u'is_self': False,
     u'likes': None,
     u'link_flair_css_class': None,
     u'link_flair_text': None,
     u'media': None,
     u'media_embed': {},
     u'mod_reports': [],
     u'name': u't3_2vsxmq',
     u'num_comments': 2,
     u'num_reports': None,
     u'over_18': False,
     u'permalink': u'/r/Gandalf/comments/2vsxmq/gandalf_at_the_party/',
     u'report_reasons': None,
     u'saved': False,
     u'score': 17,
     u'secure_media': None,
     u'secure_media_embed': {},
     u'selftext': u'',
     u'selftext_html': None,
     u'stickied': False,
     u'subreddit': u'Gandalf',
     u'subreddit_id': u't5_2uz70',
     u'thumbnail': u'http://b.thumbs.redditmedia.com/FSkFE7Zu_E3YJIcT3N9wewFdq_F9Y-_jkeC1wKSZK_Q.jpg',
     u'title': u'Gandalf at the party',
     u'ups': 17,
     u'url': u'http://40.media.tumblr.com/8a5bda9c361b01b03fe988bf0c825596/tumblr_nfbwek8YfP1t23cxko1_1280.jpg',
     u'user_reports': [],
     u'visited': False},
    u'kind': u't3'},
   {u'data': {u'approved_by': None,
     u'archived': False,
     u'author': u'unlivablepillow',
     u'author_flair_css_class': None,
     u'author_flair_text': None,
     u'banned_by': None,
     u'clicked': False,
     u'created': 1423814357.0,
     u'created_utc': 1423785557.0,
     u'distinguished': None,
     u'domain': u'youtube.com',
     u'downs': 0,
     u'edited': False,
     u'gilded': 0,
     u'hidden': False,
     u'id': u'2vpjh7',
     u'is_self': False,
     u'likes': None,
     u'link_flair_css_class': None,
     u'link_flair_text': None,
     u'media': {u'oembed': {u'author_name': u'Maran Nebbeling',
       u'author_url': u'http://www.youtube.com/user/shenkeey',
       u'description': u"Just ten hours of Gandalf banging his head to Run Away. I tried to keep as much of the quality as possible and as full-screen as possible (without cropping: it's hard, because the original video isn't full-screen either!) Enjoy and please share, like, subscribe, comment; all that good stuff!",
       u'height': 338,
       u'html': u'&amp;lt;iframe class="embedly-embed" src="//cdn.embedly.com/widgets/media.html?src=http%3A%2F%2Fwww.youtube.com%2Fembed%2FJLvxWNxymNc%3Ffeature%3Doembed&amp;amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DJLvxWNxymNc&amp;amp;image=http%3A%2F%2Fi.ytimg.com%2Fvi%2FJLvxWNxymNc%2Fhqdefault.jpg&amp;amp;key=2aa3c4d5f3de4f5b9120b660ad850dc9&amp;amp;type=text%2Fhtml&amp;amp;schema=youtube" width="600" height="338" scrolling="no" frameborder="0" allowfullscreen&amp;gt;&amp;lt;/iframe&amp;gt;',
       u'provider_name': u'YouTube',
       u'provider_url': u'http://www.youtube.com/',
       u'thumbnail_height': 360,
       u'thumbnail_url': u'http://i.ytimg.com/vi/JLvxWNxymNc/hqdefault.jpg',
       u'thumbnail_width': 480,
       u'title': u'10 Hours of Gandalf Europop Nod',
       u'type': u'video',
       u'url': u'http://www.youtube.com/watch?v=JLvxWNxymNc',
       u'version': u'1.0',
       u'width': 600},
      u'type': u'youtube.com'},
     u'media_embed': {u'content': u'&amp;lt;iframe class="embedly-embed" src="//cdn.embedly.com/widgets/media.html?src=http%3A%2F%2Fwww.youtube.com%2Fembed%2FJLvxWNxymNc%3Ffeature%3Doembed&amp;amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DJLvxWNxymNc&amp;amp;image=http%3A%2F%2Fi.ytimg.com%2Fvi%2FJLvxWNxymNc%2Fhqdefault.jpg&amp;amp;key=2aa3c4d5f3de4f5b9120b660ad850dc9&amp;amp;type=text%2Fhtml&amp;amp;schema=youtube" width="600" height="338" scrolling="no" frameborder="0" allowfullscreen&amp;gt;&amp;lt;/iframe&amp;gt;',
      u'height': 338,
      u'scrolling': False,
      u'width': 600},
     u'mod_reports': [],
     u'name': u't3_2vpjh7',
     u'num_comments': 0,
     u'num_reports': None,
     u'over_18': False,
     u'permalink': u'/r/Gandalf/comments/2vpjh7/its_been_awhile_since_gandalf_cast_this_spell_on/',
     u'report_reasons': None,
     u'saved': False,
     u'score': 8,
     u'secure_media': {u'oembed': {u'author_name': u'Maran Nebbeling',
       u'author_url': u'http://www.youtube.com/user/shenkeey',
       u'description': u"Just ten hours of Gandalf banging his head to Run Away. I tried to keep as much of the quality as possible and as full-screen as possible (without cropping: it's hard, because the original video isn't full-screen either!) Enjoy and please share, like, subscribe, comment; all that good stuff!",
       u'height': 338,
       u'html': u'&amp;lt;iframe class="embedly-embed" src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FJLvxWNxymNc%3Ffeature%3Doembed&amp;amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DJLvxWNxymNc&amp;amp;image=http%3A%2F%2Fi.ytimg.com%2Fvi%2FJLvxWNxymNc%2Fhqdefault.jpg&amp;amp;key=2aa3c4d5f3de4f5b9120b660ad850dc9&amp;amp;type=text%2Fhtml&amp;amp;schema=youtube" width="600" height="338" scrolling="no" frameborder="0" allowfullscreen&amp;gt;&amp;lt;/iframe&amp;gt;',
       u'provider_name': u'YouTube',
       u'provider_url': u'http://www.youtube.com/',
       u'thumbnail_height': 360,
       u'thumbnail_url': u'https://i.embed.ly/1/image?url=http%3A%2F%2Fi.ytimg.com%2Fvi%2FJLvxWNxymNc%2Fhqdefault.jpg&amp;amp;key=b1e305db91cf4aa5a86b732cc9fffceb',
       u'thumbnail_width': 480,
       u'title': u'10 Hours of Gandalf Europop Nod',
       u'type': u'video',
       u'url': u'http://www.youtube.com/watch?v=JLvxWNxymNc',
       u'version': u'1.0',
       u'width': 600},
      u'type': u'youtube.com'},
     u'secure_media_embed': {u'content': u'&amp;lt;iframe class="embedly-embed" src="https://cdn.embedly.com/widgets/media.html?src=https%3A%2F%2Fwww.youtube.com%2Fembed%2FJLvxWNxymNc%3Ffeature%3Doembed&amp;amp;url=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DJLvxWNxymNc&amp;amp;image=http%3A%2F%2Fi.ytimg.com%2Fvi%2FJLvxWNxymNc%2Fhqdefault.jpg&amp;amp;key=2aa3c4d5f3de4f5b9120b660ad850dc9&amp;amp;type=text%2Fhtml&amp;amp;schema=youtube" width="600" height="338" scrolling="no" frameborder="0" allowfullscreen&amp;gt;&amp;lt;/iframe&amp;gt;',
      u'height': 338,
      u'scrolling': False,
      u'width': 600},
     u'selftext': u'',
     u'selftext_html': None,
     u'stickied': False,
     u'subreddit': u'Gandalf',
     u'subreddit_id': u't5_2uz70',
     u'thumbnail': u'http://b.thumbs.redditmedia.com/nJpbgbioDWBc9nzNlEUQWMpQTH2Kb8FV6EAtf6NN0zI.jpg',
     u'title': u'its been awhile since gandalf cast this spell on me..',
     u'ups': 8,
     u'url': u'https://www.youtube.com/watch?v=JLvxWNxymNc',
     u'user_reports': [],
     u'visited': False},
    u'kind': u't3'}],
  u'modhash': u''},
 u'kind': u'Listing'}
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As you can see, it's a bit of the heirarchical metadata thing going on, but aside from that, there are a <em>lot</em> of properties being returned for each listing object.</p>
<p>Remember the scenario mentioned earlier of the client-side code streamlining the data for consumption by the front-end?  What if in this case only a couple properties were needed from each listing? Say... title and thumbnail?</p>
<p>If only we had a nice general purpose crowbar of a function that could pry out those properties, regardless of how the data was structured.</p>
<p>A recursive function will work nicely for this:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [20]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="k">def</span> <span class="nf">has_keys</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">d</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">extract</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sub_data</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">extract</span><span class="p">(</span><span class="n">sub_data</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">has_keys</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
            <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">extract</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's try it on the reddit data, but with a higher limit this time:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [25]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'http://www.reddit.com/r/gandalf.json?limit=8'</span><span class="p">,</span>
                 <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">'User-Agent'</span><span class="p">:</span> <span class="s">'OSU cs496 api howto ipynb'</span><span class="p">})</span>
<span class="n">j</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

<span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">'title'</span><span class="p">,</span> <span class="s">'thumbnail'</span><span class="p">]</span>
<span class="n">processed_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">extract</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">processed_data</span><span class="p">)</span>

<span class="n">processed_data</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[25]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
[{'thumbnail': u'http://b.thumbs.redditmedia.com/FSkFE7Zu_E3YJIcT3N9wewFdq_F9Y-_jkeC1wKSZK_Q.jpg',
  'title': u'Gandalf at the party'},
 {'thumbnail': u'http://b.thumbs.redditmedia.com/nJpbgbioDWBc9nzNlEUQWMpQTH2Kb8FV6EAtf6NN0zI.jpg',
  'title': u'its been awhile since gandalf cast this spell on me..'},
 {'thumbnail': u'http://b.thumbs.redditmedia.com/9ystXh9Wzq9GGODnvJ9ALHOpWMmp0KMKe8Ht25B_DUU.jpg',
  'title': u'\u201cOnly quite a little fellow in a wide world after all.\u201d The Hobbit: The Battle of The Five Armies'},
 {'thumbnail': u'http://a.thumbs.redditmedia.com/ib2ezpk1n5o3QSJG4wA7WnjbMDjSwopCwP56DO_zmC0.jpg',
  'title': u'Looking particularly badass, by OtisFrampton'},
 {'thumbnail': u'http://b.thumbs.redditmedia.com/-D02lKr4B3vl-TkQEDSqIccJ7mqXgL0WsdY7B75HU2U.jpg',
  'title': u"\u202aIt's Still Middle-Earth To Me (Billy Joel Hobbit Parody)\u202c"},
 {'thumbnail': u'self',
  'title': u"Quote of the day, November, 23rd!!! [It's my birthday]"},
 {'thumbnail': u'http://b.thumbs.redditmedia.com/8mbKDjEbS0nPu7GEK1v8kCgUkSMuTG2qzr4LCw9n4cA.jpg',
  'title': u"Gandalf's Song, A Tomodachi Life song, 3DS."},
 {'thumbnail': u'self', 'title': u'Daily /r/Gandalf quote: 11/4/2014'}]
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Nice and concise!  But if the function is truly <em>general purpose</em> it should work on a different api with no modification:</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [23]:
</div>
<div class="inner_cell">
<div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">keys</span> <span class="o">=</span> <span class="p">[</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'grade'</span><span class="p">]</span>
<span class="n">processed_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">extract</span><span class="p">(</span><span class="n">backup_copy</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span> <span class="n">processed_data</span><span class="p">)</span>  <span class="c">#backup_copy is the school data from earlier</span>

<span class="n">processed_data</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span> <span class="c">#show the first 20</span>
</pre></div>
</div>
</div>
</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area"><div class="prompt output_prompt">
    Out[23]:</div>
<div class="output_text output_subarea output_pyout">
<pre>
[{'grade': u'10', 'name': u'Group Guidance - 101 - B. Greene (Section 1)'},
 {'grade': u'10', 'name': u'Group Guidance - 102 - T. Vaux (Section 2)'},
 {'grade': u'10', 'name': u'Group Guidance - 103 - E. Britcher (Section 3)'},
 {'grade': u'10', 'name': u'Group Guidance - 104 - J. Isaacs (Section 4)'},
 {'grade': u'10', 'name': u'Group Guidance - 105 - J. Cummings (Section 5)'},
 {'grade': u'10', 'name': u'Group Guidance - 106 - M. Nagle (Section 6)'},
 {'grade': u'6', 'name': u'Sixth Grade Advisory - 601 - S. Madison'},
 {'grade': u'6',
  'name': u'Sixth Grade Advisory - 602 - R. Monroe (Section 2)'},
 {'grade': u'6',
  'name': u'Sixth Grade Advisory - 603 - K. Hudson (Section 3)'},
 {'grade': u'7', 'name': u'Seventh Grade Advisory - 701 - S. Madison'},
 {'grade': u'7', 'name': u'Seventh Grade Advisory - 702 - R. Monroe'},
 {'grade': u'7', 'name': u'Seventh Grade Advisory - 703 - K. Hudson'},
 {'grade': u'8', 'name': u'Eighth Grade Advisory - 801 - S. Madison'},
 {'grade': u'8', 'name': u'Eighth Grade Advisory - 802 - R. Monroe'},
 {'grade': u'8', 'name': u'Eighth Grade Advisory - 803 - K. Hudson'},
 {'grade': u'9', 'name': u'Group Guidance - 901 - B. Greene (Section 1)'},
 {'grade': u'9', 'name': u'Group Guidance - 902 - T. Vaux (Section 2)'},
 {'grade': u'9', 'name': u'Group Guidance - 903 - E. Britcher (Section 3)'},
 {'grade': u'9', 'name': u'Group Guidance - 904 - J. Isaacs (Section 4)'},
 {'grade': u'9', 'name': u'Group Guidance - 905 - J. Cummings (Section 5)'}]
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It worked!  This would be particularly useful if it was necessary to aggregate data from several different apis.</p>
<p><strong>This concludes the how-to</strong> thank you for reading!</p>
</div>
</div>
</div></body></html>
                    </section>
                    <hr/>
                    <aside class="post-meta">
                        <p>Category: <a href="/category/python.html">Python</a></p>
                    </aside>
                    <hr/>
<div class="comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_shortname = 'skaliak';
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
                </article>
            </li>
        </ol>
    </div>
        </div>

<script>
    var _gaq=[['_setAccount','UA-61687565-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
</script>
        <script src="/theme/js/main.js"></script>
    </body>
</html>